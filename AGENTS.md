# AGENTS.md

## 役割

このAGENTは本リポジトリにおいて以下を行う。

- コードの生成・修正
- テストの追加・修正
- ドキュメントの更新

## プロジェクト概要

本プロジェクトの目的、提供機能、基本的な利用方法は[README.md](README.md)を参照。

## ガードレール／禁止事項

- ワークスペース外へファイルアクセスを禁止する
- ワークスペース外に影響を与えるコマンドの実行を禁止する
- 秘密情報（APIキー、トークン、認証情報）を追加しない

## 変更ポリシー

- 既存仕様の変更・削除は明示的な指示がない限り行わない
- 既存コードの意図を尊重し、変更範囲は最小限に保つ

## コマンド

コマンド実行前に、内容と影響範囲を確認すること。  
DBマイグレーション系のコマンドは明示的な指示がない限り実行してはならない。

- `npm run build`: プロジェクトのビルド
- `npm run format`: コード整形実行
- `npm run generate:i18n-types`: json形式の言語ファイルからTypeScript型定義を作成
- `npm run generate:openapi`: TypeScriptで記述されたOpenAPI情報からOpenAPIファイルを作成
- `npm run generate:openapi-types`: OpenAPIファイルからTypeScript型定義を作成
- `npm run generate:auth-schema`: better-auth設定からスキーマ情報生成
- `npm run generate:migration`: DBマイグレーションファイル作成
- `npm run dev:migrate`: DBマイグレーション実行
- `npx tsc`: TypeScript型チェック実行
- `npx exlint`: ESLintチェック実行
- `npm run test`: 単体テスト実行（全体）
- `npx vitest run <targetFilePath>`: 単体テスト実行（ファイル指定） 

## アーキテクチャ

AGENTは以下を**必ず（MUST）**前提としてコードを生成・修正すること。

- コーディング規約: [docs/architectures/code.md](docs/architectures/code.md)を参照
- ディレクトリ構成: [docs/architectures/directory.md](docs/architectures/directory.md)を参照

## テスト方針

AGENT は以下の方針に従ってテストを追加・修正すること。

### 粒度

- 単体テストを基本とする
- 1テストケースは「1つの振る舞い」を検証する
- 内部実装ではなく、公開インターフェースや振る舞いを検証する

### 対象

- 重要な分岐・エッジケースは必ずテストする
- バグ修正時は、再発防止のテストを必ず追加する
- 既存テストがある場合は、そのスタイル・粒度を優先する

### 禁止事項

- 実装詳細に強く依存するテストを書かない
- 不安定なテスト（時間依存・乱数依存・環境依存）を書かない
  - 時間に依存する処理は、タイマーのモック等を用いて制御する
- 不要に網羅率だけを目的としたテストを追加しない

### 外部依存

- DB や外部サービスに依存する処理は、可能な限りモックまたはスタブを使用する
- 実 DB を使用するテストは、明示的な指示がある場合のみ追加する

### 配置

- テストファイルの配置・命名規則は既存構成に従う
  - 既存ルールがない場合は、テスト対象ファイルが存在するディレクトリ内に `_tests` ディレクトリを作成し、その中に配置する
- 新規追加時は、対象ファイルと対応関係が分かる場所に配置する

### 実行

- 変更範囲が限定的な場合は、対象ファイルのみテストを実行する
- 全体への影響がある場合は、全テストを実行する
