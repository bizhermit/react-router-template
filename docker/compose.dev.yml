name: template-dev
services:
  app:
    image: node24-dev
    build:
      context: ../
      dockerfile: .devcontainer/docker/node/Dockerfile
    tty: true
    user: "${UID:-1000}:${GID:-1000}"
    working_dir: /workspace
    volumes:
      - "../:/workspace"
      - "~/.ssh:/home/node/.ssh"
      - "node_modules:/workspace/node_modules"
      - "react-router:/workspace/.react-router"
      - "playwright:/workspace/.playwright"
    environment:
      LOCALHOST: "${LOCALHOST:-host.docker.internal}"
      DEV_PORT: "${DEV_PORT:-5173}"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  postgres:
    restart: "no"
    volumes:
      - "postgres:/var/lib/postgresql/data"
      - "../database/postgres/init:/docker-entrypoint-initdb.d"
    ports:
      - "${POSTGRES_PORT:-5432}:${POSTGRES_PORT:-5432}"
    command: >
      postgres
      -c "port=${POSTGRES_PORT:-5432}"
      -c "log_destination=stderr"
      -c "log_min_messages=${POSTGRES_LOG_LEVEL:-WARNING}"
      -c "log_connections=on"
      -c "log_disconnections=on"
      -c "log_statement=all"

volumes:
  node_modules:
  react-router:
  playwright:
  postgres:
